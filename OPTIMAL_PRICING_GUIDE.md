# üéØ Optimal Pricing Architecture - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## üìã –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

–ú—ã —Å–æ–∑–¥–∞–ª–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä–∞—è –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç API –∑–∞–ø—Ä–æ—Å—ã –∫ Monday.com –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±—ã—Å—Ç—Ä—É—é —Ä–∞–±–æ—Ç—É –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1. **–ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)**
- ‚úÖ –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ü–µ–Ω—ã –∏–∑ Supabase –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ 30-–º–∏–Ω—É—Ç–Ω—ã–π –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–µ—à –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö –ø—Ä—è–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Monday.com API
- ‚úÖ –ë—ã—Å—Ç—Ä–æ–µ –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ (<100ms)

### 2. **–°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å (Supabase)**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏–∑ Monday.com
- ‚úÖ Edge Function —É–ø—Ä–∞–≤–ª—è–µ—Ç API –ª–∏–º–∏—Ç–∞–º–∏
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–µ—à –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä—É—á–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

## üìä –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Supabase)
```sql
-- –¢–∞–±–ª–∏—Ü–∞ –∫–µ—à–∞ —Ü–µ–Ω
CREATE TABLE pricing_cache (
  price_key VARCHAR(100) UNIQUE,
  price_value DECIMAL(10,2),
  unit VARCHAR(50),
  monday_item_id VARCHAR(100),
  last_updated TIMESTAMPTZ
);

-- –õ–æ–≥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
CREATE TABLE pricing_sync_log (
  sync_started_at TIMESTAMPTZ,
  sync_completed_at TIMESTAMPTZ,
  items_updated INTEGER,
  status VARCHAR(50)
);
```

### –°–µ—Ä–≤–∏—Å—ã
1. **`finalPricingService.ts`** - –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
2. **`daily-price-sync/index.ts`** - Supabase Edge Function –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
3. **`optimalCalculations.ts`** - –†–∞—Å—á–µ—Ç—ã —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
1. **`PricingAdminPanel.tsx`** - –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ü–µ–Ω–∞–º–∏
2. **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `PricingCalculator.tsx`** - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ü–µ–Ω—ã

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

#### 1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
```typescript
import { finalPricingService } from '../services/finalPricingService';

// –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ
const pricing = await finalPricingService.getPricingComponents();

// –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ü–µ–Ω—ã
const controllerPrice = await finalPricingService.getPrice('controller');
```

#### 2. –†–∞—Å—á–µ—Ç —Ü–µ–Ω—ã —Ç–æ–≤–∞—Ä–∞
```typescript
import { calculateOptimalSignPrice } from '../utils/optimalCalculations';

const price = await calculateOptimalSignPrice(
  design, width, height, isWaterproof, isTwoPart, hasUvPrint
);
```

#### 3. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ
```typescript
import { getOptimalShippingInfo } from '../utils/optimalCalculations';

const shipping = await getOptimalShippingInfo(longestSideCm);
```

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

#### –î–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
```
http://localhost:5174/admin/pricing
```

#### –§—É–Ω–∫—Ü–∏–∏ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏:
- üìä –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–∏—Ö —Ü–µ–Ω –∏–∑ –∫–µ—à–∞
- üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ü–µ–Ω
- üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- ‚ö° –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

### 1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
- **–î–æ:** üêå –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí Monday.com API (slow)
- **–ü–æ—Å–ª–µ:** ‚ö° –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí Supabase DB (fast)

### 2. **API –ª–∏–º–∏—Ç—ã**
- **–î–æ:** üö´ 8,640+ –∑–∞–ø—Ä–æ—Å–æ–≤/–º–µ—Å—è—Ü –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ü–æ—Å–ª–µ:** ‚úÖ ~30 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–µ—Å—è—Ü –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞

### 3. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**
- **–î–æ:** ‚ùå –°–±–æ–π –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Monday.com
- **–ü–æ—Å–ª–µ:** ‚úÖ Fallback —Ü–µ–Ω—ã + –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–µ—à

### 4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**
- **–î–æ:** üìâ –õ–∏–º–∏—Ç—ã —Ä–∞—Å—Ç—É—Ç —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ü–æ—Å–ª–µ:** üìà –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```env
# Supabase
VITE_SUPABASE_URL=your_supabase_url
VITE_SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# Monday.com (–¥–ª—è Edge Function)
MONDAY_API_TOKEN=your_monday_token
MONDAY_BOARD_ID=2090208832
```

### 2. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
```bash
# –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã
supabase db push

# –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å Edge Function
supabase functions deploy daily-price-sync
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
–°–æ–∑–¥–∞–π—Ç–µ cron job –≤ Supabase –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ Edge Function:
```sql
SELECT cron.schedule(
  'daily-price-sync',
  '0 2 * * *', -- –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00
  $$
  SELECT net.http_post(
    url := 'https://your-project.supabase.co/functions/v1/daily-price-sync',
    headers := jsonb_build_object('Authorization', 'Bearer ' || 'YOUR_SERVICE_ROLE_KEY')
  );
  $$
);
```

## üîß –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
```sql
SELECT * FROM pricing_sync_log 
ORDER BY sync_started_at DESC 
LIMIT 10;
```

### –ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å —Ü–µ–Ω
```sql
SELECT price_key, price_value, last_updated 
FROM pricing_cache 
ORDER BY last_updated DESC;
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–ó–∞–¥–∞—á–∞ —Ä–µ—à–µ–Ω–∞:** –°–æ–∑–¥–∞–Ω–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–¥–Ω–∏–º–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–µ–∫–µ–Ω–¥  
‚úÖ **API –ª–∏–º–∏—Ç—ã:** –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–æ ~1 –∑–∞–ø—Ä–æ—Å–∞ –≤ –¥–µ–Ω—å  
‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Ü–µ–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** Fallback —Å–∏—Å—Ç–µ–º–∞ –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ  
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –ì–æ—Ç–æ–≤–∞ –∫ —Ä–æ—Å—Ç—É –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º–æ–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
1. **–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å:** `/admin/pricing`
2. **–õ–æ–≥–∏ Supabase:** Dashboard ‚Üí Functions ‚Üí daily-price-sync
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** Dashboard ‚Üí Database ‚Üí pricing_cache table
